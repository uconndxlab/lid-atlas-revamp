<!doctype html>
<html class="no-js" lang="">

<head>
  <meta charset="utf-8">
  <title>LID Atlas</title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="manifest" href="site.webmanifest">
  <link rel="apple-touch-icon" href="icon.png">
  <link rel="icon" href="favicon.ico" type="image/x-icon" />


  <link rel="stylesheet" href="css/normalize.css">
  <link rel="stylesheet" href="css/main.css">
  <link rel="stylesheet" href="https://use.typekit.net/baj5duk.css">
  <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v2.3.1/mapbox-gl.js'></script>
  <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v2.3.1/mapbox-gl.css' rel='stylesheet' />

  <meta name="theme-color" content="#fafafa">
</head>

<body>
  <div id="load"></div>
  <nav class="header">
    <div class="container" id="nav">
    <a href="index.html" class="logo">LID Atlas</a>
    <input class="menu-btn" type="checkbox" id="menu-btn" />
    <label class="menu-icon" for="menu-btn"><span class="navicon"></span></label>
    <ul class="menu">
      <li><a href="about.html">About</a></li>
      <li><a href="https://docs.google.com/forms/d/e/1FAIpQLSeC3sCIr6hPgsMH71d5VxDbaLNtcCa4uCSkO0M6OBTQJ1yKQA/viewform?formkey=dDg2RTkyZXlJMlZzbzZMbnJsb29RUlE6MQ#gid=0">Add</a></li>
      <li><a href="contact.html">Contact</a></li>
    </ul>
  </div>
  </nav>


  
  <div  id="contents" class="container">
      <div class="content">
      <div class="map-filters">
        <!--<div class="row">
          <div class="col">
              <input class="form-control" id="search" type="text" placeholder="Search..."/>
          </div>
      </div>-->
        <span id="project-filters" class="checkbox-filters">
            <label class="checkbox-container">All Projects
              <input id="allproj" type="checkbox" checked="checked" value="all">
              <span class="checkmark"></span>
            </label>
            <hr width="100px" style="margin: 20px 0; border:1px solid #ccc;">
            <label class="checkbox-container">Swale/Bioswale
              <input class="project" name="project" checked="checked" type="checkbox" value="1">
              <span class="checkmark"></span>
            </label>
            <label class="checkbox-container">Bioretention/Rain Garden
              <input class="project" name="project" checked="checked" type="checkbox" value="2">
              <span class="checkmark"></span>
            </label>
            <label class="checkbox-container">Cistern/Rain Barrel
              <input class="project" name="project" checked="checked" type="checkbox" value="3">
              <span class="checkmark"></span>
            </label>
            <label class="checkbox-container">Stormwater Wetlands
              <input class="project" name="project" checked="checked" type="checkbox" value="4">
              <span class="checkmark"></span>
            </label>
            <label class="checkbox-container">Green Roof
              <input class="project" name="project" checked="checked" type="checkbox" value="5">
              <span class="checkmark"></span>
            </label>
            <label class="checkbox-container">Permeable Pavement
              <input class="project" name="project" checked="checked" type="checkbox" value="6">
              <span class="checkmark"></span>
            </label>
            <label class="checkbox-container">Water Conservation
              <input class="project" name="project" checked="checked" type="checkbox" value="7">
              <span class="checkmark"></span>
            </label>
            <label class="checkbox-container">Green Streets
              <input class="project" name="project" checked="checked" type="checkbox" value="8">
              <span class="checkmark"></span>
            </label>
            <label class="checkbox-container">Other
              <input class="project" name="project" checked="checked" type="checkbox" value="9">
              <span class="checkmark"></span>
            </label>

        </span>

        <span class="dropdown-state">
          <h3>State:</h3>
          <select id="state" class="dropdown" name="state" size="1">    
            <option value="all">All States</option>
						<option value="AL" >Alabama</option>
            <option value="AK" >Alaska</option>
            <option value="AZ" >Arizona</option>
            <option value="AR" >Arkansas</option>
            <option value="CA" >California</option>
            <option value="CO" >Colorado</option>
            <option value="CT" >Connecticut</option>
            <option value="DE" >Delaware</option>
            <option value="DC" >Dist of Columbia</option>
            <option value="FL" >Florida</option>
            <option value="GA" >Georgia</option>
            <option value="HI" >Hawaii</option>
            <option value="ID" >Idaho</option>
            <option value="IL" >Illinois</option>
            <option value="IN" >Indiana</option>
            <option value="IA" >Iowa</option>
            <option value="KS" >Kansas</option>
            <option value="KY" >Kentucky</option>
            <option value="LA" >Louisiana</option>
            <option value="ME" >Maine</option>
            <option value="MD" >Maryland</option>
            <option value="MA" >Massachusetts</option>
            <option value="MI" >Michigan</option>
            <option value="MN" >Minnesota</option>
            <option value="MS" >Mississippi</option>
            <option value="MO" >Missouri</option>
            <option value="MT" >Montana</option>
            <option value="NE" >Nebraska</option>
            <option value="NV" >Nevada</option>
            <option value="NH" >New Hampshire</option>
            <option value="NJ" >New Jersey</option>
            <option value="NM" >New Mexico</option>
            <option value="NY" >New York</option>
            <option value="NC" >North Carolina</option>
            <option value="ND" >North Dakota</option>
            <option value="OH" >Ohio</option>
            <option value="OK" >Oklahoma</option>
            <option value="OR" >Oregon</option>
            <option value="PA" >Pennsylvania</option>
            <option value="RI" >Rhode Island</option>
            <option value="SC" >South Carolina</option>
            <option value="SD" >South Dakota</option>
            <option value="TN" >Tennessee</option>
            <option value="TX" >Texas</option>
            <option value="UT" >Utah</option>
            <option value="VT" >Vermont</option>
            <option value="VA" >Virginia</option>
            <option value="WA" >Washington</option>
            <option value="WV" >West Virginia</option>
            <option value="WI" >Wisconsin</option>
            <option value="WY" >Wyoming</option>
          </select>
      </span>
      <span class="dropdown-land">
        <h3>Land Use Type:</h3>
        <select id="land" class="dropdown" name="land">    
          <option value="all">All Types</option>
          <option name="devType" id="devType" value="3">Civic/Public</option>
          <option name="devType" id="devType" value="1">Commercial</option>
          <option name="devType" id="devType" value="5">Green Streets</option>
          <option name="devType" id="devType" value="4">Mixed Use</option>
          <option name="devType" id="devType" value="2">Residential</option>
        </select>
    </span>
    <!--<button id="list-map-btn">Show List</button>-->
  </div>
  <div id="list">
    <h3 style="margin-top: 0"></h3>
    <ul id="gathered_info"></ul>
  </div>
    <div>
      <div id="map"></div>
      
    </div>
    </div>

    
        
  </div>
  

  
  <!--[if IE]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->

  <!-- Add your site or application content here -->
  <script src="js/vendor/modernizr-3.8.0.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
  <script>window.jQuery || document.write('<script src="js/vendor/jquery-3.4.1.min.js"><\/script>')</script>
  <script src="js/plugins.js"></script>
  <script src="js/main.js"></script>
  

  <!-- Google Analytics: change UA-XXXXX-Y to be your site's ID. -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-XXXXX-Y', 'auto'); ga('set','transport','beacon'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async></script>


  <script>
  mapboxgl.accessToken = 'pk.eyJ1IjoidGhlbmF0YXR0YWNrIiwiYSI6ImNrcWIzb2xqYzA4bGcydXBvOWk5cnpvdWgifQ.EEs2Ox8pWunarciy6oAptA';


let map = new mapboxgl.Map({
container: 'map',
style: 'mapbox://styles/mapbox/streets-v11',
center: [-96, 37.8],
zoom: 3
});

//clear current map, get data, put data into array, map data

var currentMarkers=[]

async function getData(url){
  if (currentMarkers!=null){
    for (var i = currentMarkers.length - 1; i >= 0; i--){
      currentMarkers[i].remove();
    }
  }
  const response = await fetch(url)
  var data = await response.json()
  for (i in data){
    var el = document.createElement('div');
    
    if (data[i].developmentTypeID === 1){
      el.className = 'marker-yellow';
    }
    else if (data[i].developmentTypeID === 2){
      el.className = 'marker-blue';
    }
    else if (data[i].developmentTypeID === 3){
      el.className = 'marker-red';
    }
    else if (data[i].developmentTypeID === 4){
      el.className = 'marker-orange';
    }
    else if (data[i].developmentTypeID === 5){
      el.className = 'marker-green';
    }
    var marker = new mapboxgl.Marker(el)
    .setLngLat([data[i].longitude, data[i].latitude])
    .setPopup(
    new mapboxgl.Popup({ offset: 25 }) // add popups
    .setHTML(
    '<h3>' +
    data[i].projectName +
    '</h3><p>' +
    data[i].caption +
    '</p>'
    )
    )
    .addTo(map);
   currentMarkers.push(marker)
  }
  
}

map.addControl(new mapboxgl.NavigationControl());

var projects = []
var statevalue = ""
var devtype = ""
var projtype = ""

function getUrl(){
  return 'https://nemo.uconn.edu/api/projects?limit=5000'+statevalue+devtype+projtype
}

var state = document.getElementById('state')
var land = document.getElementById('land')

//state filter dropdown
state.addEventListener('change', () => {
  statevalue = '&state='+state.value
  if (state.value==='all'){
    statevalue = ""
  }
  getData(getUrl())
})

//land filter dropdown
land.addEventListener('change', () => {
  devtype = '&developmentTypeID='+land.value
  if (land.value==='all'){
    devtype = ""
  }
  getData(getUrl())
})

 //project type checkbox filter

 var checkboxes = document.querySelectorAll('.project');
 var projectfilters = document.getElementById('project-filters')

 var allproj = document.getElementById('allproj');
  document.querySelectorAll('.project').forEach(item => {item.addEventListener('click', () => {
    allproj.checked=false;
    })
  })

  allproj.addEventListener('click', () => {
    allproj.setAttribute('checked',true)
    if (allproj.checked){
    checkboxes.forEach(item => {item.checked=true})
    projtype = ""
    getData(getUrl())
    }
    else{
      checkboxes.forEach(item => {item.checked=false})
    }
  })


  function getSelectedCheckboxes(name) {
    const projcheckboxes = document.querySelectorAll('input[name="project"]:checked');
    projects = []
    projcheckboxes.forEach((checkbox) => {
      projects.push(checkbox.value);
    })
    if (projects.length === 9){
      projtype = ""
      getData(getUrl())
    }
    else if (projects.length === 0){
      projtype = ""
      for (var i = currentMarkers.length - 1; i >= 0; i--){
      currentMarkers[i].remove();
    }
    }
    else{
      projtype="&typeID="+projects.join(',')    
      getData(getUrl())
    }
  }

  projectfilters.addEventListener('change', (event) => {
    getSelectedCheckboxes('project')
  })
  




  var listmap = document.getElementById('list-map-btn')
  var listshow = document.getElementById('list')
  listmap.addEventListener('click', () => {
    if (listmap.innerHTML == 'Show List'){
      listmap.innerHTML = 'Hide List';
      showList()
    }
    else{
      listmap.innerHTML = 'Show List';
      hideList()
  }
  })
  /*
  let list = document.getElementById('list')
  function showList(){
    var map = document.getElementById('map')
    var x = window.matchMedia("(min-width:768px)")
    if (x.matches){
    map.style.width = '50%'
    list.style.zIndex = 2
    list.style.height = contain;}

  }

  function hideList(){
    var map = document.getElementById('map')
    var x = window.matchMedia("(min-width:768px)")
    if (x.matches){
    map.style.width = '77.4%'
    list.style.zIndex = 0}
    else{
      map.style.width = '100%';
      list.style.zIndex = -1;
      list.style.height = 0;
    }
  }
*/

 

  //show loading sign until ready to display
  document.onreadystatechange = function () {
  var state = document.readyState
  if (state == 'interactive') {
       document.getElementById('contents').style.visibility="hidden";
  } else if (state == 'complete') {
      setTimeout(function(){
         document.getElementById('interactive');
         document.getElementById('load').style.visibility="hidden";
         document.getElementById('contents').style.visibility="visible";
      },1000);
  }
}

  
  getData('https://nemo.uconn.edu/api/projects?limit=5000')

  </script>

</body>

</html>

